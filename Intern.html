<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<link rel="icon" href="./assets/favicon.png">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Polizei - Deutschland RP</title>
<style>
/* =========================================
   1. BASIS STYLES
   ========================================= */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1419 100%);
  color: #fff;
  min-height: 100vh;
}

/* =========================================
   2. LOGIN & QUIZ STYLES (Zentriert)
   ========================================= */
.center-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: 20px;
}

.auth-card {
  background: linear-gradient(135deg, rgba(15, 32, 39, 0.95), rgba(44, 83, 100, 0.9));
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 40px;
  max-width: 600px;
  width: 100%;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(255, 215, 0, 0.3);
  text-align: center;
}

.logo { font-size: 50px; margin-bottom: 20px; }
.login-title { font-size: 32px; font-weight: 900; color: #ffd700; margin-bottom: 10px; }
.subtitle { color: #cbd5e0; margin-bottom: 30px; line-height: 1.6; }

/* Discord Button */
.btn-discord {
  background: #5865F2;
  color: white;
  padding: 15px 30px;
  border-radius: 8px;
  border: none;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
}
.btn-discord:hover { background: #4752c4; transform: translateY(-2px); }

/* Quiz Elements */
.quiz-container { text-align: left; display: none; }
.quiz-progress { color: #ffd700; font-size: 14px; margin-bottom: 15px; text-align: right; }
.question-text { font-size: 20px; font-weight: 600; margin-bottom: 25px; }
.options-grid { display: grid; gap: 15px; }

.option-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.1);
  padding: 15px;
  border-radius: 10px;
  color: white;
  text-align: left;
  cursor: pointer;
  transition: all 0.2s;
}
.option-btn:hover { background: rgba(255, 215, 0, 0.1); border-color: #ffd700; }

/* Fail Screen */
.fail-screen { display: none; color: #fca5a5; }
.fail-icon { font-size: 60px; margin-bottom: 20px; }

/* =========================================
   3. DASHBOARD STYLES (Dein urspr√ºngliches Design)
   ========================================= */
.dashboard { display: none; } /* Standardm√§√üig ausgeblendet */

.container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

/* Header */
.header {
  background: rgba(0,0,0,0.6);
  border-bottom: 3px solid #ffd700;
  padding: 40px 0;
  text-align: center;
  margin-bottom: 20px;
}
.header-title { font-size: 48px; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; }
.header-subtitle { font-size: 24px; font-weight: 700; color: #ffd700; }

/* Navigation */
.nav-bar {
  background: rgba(10, 14, 39, 0.98);
  border-bottom: 2px solid rgba(255, 215, 0, 0.3);
  position: sticky; top: 0; z-index: 1000;
  margin-bottom: 40px;
}
.nav { display: flex; justify-content: center; list-style: none; gap: 5px; }
.nav > li > a {
  display: block; color: #fff; text-decoration: none; padding: 18px 24px;
  font-weight: 500; transition: all 0.3s; border-bottom: 3px solid transparent;
}
.nav > li > a:hover { color: #ffd700; border-bottom-color: #ffd700; background: rgba(255,215,0,0.1); }

/* Dropdown (Vereinfacht) */
.dropdown { position: relative; }
.dropdown-content {
  display: none; position: absolute; top: 100%; left: 0;
  background: #0f1419; min-width: 200px; border: 1px solid #ffd700;
}
.dropdown:hover .dropdown-content { display: block; }
.dropdown-content a { padding: 12px; display: block; color: #ccc; text-decoration: none; }
.dropdown-content a:hover { background: #333; color: #ffd700; }

/* Stats Cards */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 40px; }
.stat-card {
  background: linear-gradient(135deg, rgba(26, 31, 58, 0.9), rgba(15, 20, 25, 0.8));
  border-radius: 16px; padding: 30px; border: 1px solid rgba(255, 215, 0, 0.2);
  text-align: center;
}
.stat-icon { font-size: 40px; margin-bottom: 10px; }
.stat-value { font-size: 36px; font-weight: 900; color: #ffd700; }
.stat-label { color: #cbd5e0; font-size: 14px; }

/* Sections */
.section {
  background: rgba(26, 31, 58, 0.8);
  border-radius: 16px; padding: 30px; margin-bottom: 30px;
  border: 1px solid rgba(255, 215, 0, 0.15);
}
.section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
.section-title { font-size: 26px; color: #ffd700; font-weight: 800; }

.refresh-btn {
  background: transparent; border: 1px solid #ffd700; color: #ffd700;
  padding: 8px 16px; border-radius: 6px; cursor: pointer;
}
.refresh-btn:hover { background: rgba(255,215,0,0.1); }

/* Duty Grid */
.duty-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
.duty-card {
  background: rgba(255,255,255,0.03); border: 1px solid rgba(255,215,0,0.1);
  border-radius: 12px; padding: 20px;
}
.duty-header { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
.duty-avatar { width: 48px; height: 48px; border-radius: 50%; border: 2px solid #ffd700; }
.duty-badge { background: rgba(255,215,0,0.2); color: #ffd700; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
.duty-details div { display: flex; justify-content: space-between; font-size: 13px; margin-top: 5px; color: #ccc; }
.duty-val { color: #ffd700; font-weight: 600; }

/* Nummern Grid */
.nummern-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; }
.nummer-badge {
  background: rgba(74, 222, 128, 0.1); border: 1px solid #4ade80; color: #4ade80;
  padding: 10px; border-radius: 6px; text-align: center; font-weight: bold;
}

/* Nachrichten */
.message-card {
  background: rgba(255,255,255,0.03); border-left: 4px solid #ffd700;
  padding: 15px; margin-bottom: 15px; border-radius: 0 8px 8px 0;
}
.message-meta { font-size: 12px; color: #888; margin-bottom: 5px; }
.message-author { color: #ffd700; font-weight: bold; }

/* Logout */
.btn-logout {
  background: #dc2626; color: white; border: none; padding: 10px 20px;
  border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 20px;
}
.empty-state { text-align: center; padding: 20px; color: #777; }
.hidden { display: none !important; }
</style>
</head>
<body>

<div id="loginScreen" class="center-wrapper">
  <div class="auth-card">
    <div class="logo">üîí</div>
    <h1 class="login-title">Dienstportal</h1>
    <p class="subtitle">
      Bitte mit Discord verifizieren und Eignungstest absolvieren.<br>
      <small>Test nur 1x pro Account m√∂glich.</small>
    </p>
    <button id="discordLoginBtn" class="btn-discord">
      <span>Mit Discord verbinden</span>
    </button>
  </div>
</div>

<div id="quizScreen" class="center-wrapper hidden">
  <div class="auth-card">
    <div class="quiz-container" style="display: block;">
      <div class="quiz-progress">Frage <span id="qCurrent">1</span> von <span id="qTotal">10</span></div>
      <div class="question-text" id="questionText">Lade Frage...</div>
      <div class="options-grid" id="optionsContainer"></div>
    </div>
  </div>
</div>

<div id="failScreen" class="center-wrapper hidden">
  <div class="auth-card" style="border-color: #ef4444;">
    <div class="fail-icon">‚ùå</div>
    <h1 class="login-title" style="color: #ef4444;">Durchgefallen</h1>
    <p class="subtitle">
      Du hast mehr als 8 Fehlerpunkte erreicht.<br>
      Zugriff verweigert. Ergebnisse √ºbermittelt.
    </p>
  </div>
</div>

<div id="dashboardContent" class="dashboard">
  <header class="header">
    <div class="container">
      <h1 class="header-title">Polizei</h1>
      <div class="header-subtitle">DEUTSCHLAND RP - INTERNER BEREICH</div>
    </div>
  </header>

  <nav class="nav-bar">
    <div class="container">
      <ul class="nav">
        <li><a href="#">Startseite</a></li>
        <li class="dropdown">
          <a href="#">Neuigkeiten ‚ñæ</a>
          <div class="dropdown-content">
            <a href="Aktuelles.html">Aktuelles</a>
            <a href="Terrorstatus.html">Terrorstatus</a>
            <a href="Fahndungsportal.html">Fahndungsportal</a>
          </div>
        </li>
        <li class="dropdown">
          <a href="#">Mitarbeiter ‚ñæ</a>
          <div class="dropdown-content">
            <a href="Management.html">Management</a>
            <a href="Mitarbeiter.html">Mitarbeiter</a>
          </div>
        </li>
        <li class="dropdown">
          <a href="#">Sonstiges ‚ñæ</a>
          <div class="dropdown-content">
            <a href="Strafen.html">Strafen</a>
            <a href="Status.html">Status</a>
          </div>
        </li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <div style="margin-bottom: 20px; color: #ffd700;">
      Angemeldet als: <span id="userDisplay" style="font-weight: bold; color: white;">Gast</span>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-value" id="statTotal">-</div>
        <div class="stat-label">Gesamt Mitarbeiter</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üü¢</div>
        <div class="stat-value" id="statOnDuty">-</div>
        <div class="stat-label">Aktuell im Dienst</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìã</div>
        <div class="stat-value" id="statFree">-</div>
        <div class="stat-label">Freie Dienstnummern</div>
      </div>
    </div>

    <section class="section">
      <div class="section-header">
        <h2 class="section-title">üü¢ Aktuell im Dienst</h2>
        <button class="refresh-btn" onclick="loadData()">üîÑ Refresh</button>
      </div>
      <div class="duty-grid" id="dutyList">
        <div class="empty-state">Lade Daten...</div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2 class="section-title">üìã Freie Dienstnummern</h2>
      </div>
      <div class="nummern-grid" id="nummernList">
        <div class="empty-state">Lade Daten...</div>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <h2 class="section-title">üì£ Polizei-Informationen</h2>
      </div>
      <div id="messageList">
        <div class="empty-state">Lade Daten...</div>
      </div>
    </section>

    <button class="btn-logout" onclick="logout()">üö™ Abmelden</button>
  </main>
</div>

<script>
// ==========================================
// KONFIGURATION
// ==========================================
const CLIENT_ID = '1448720203113300161'; 
const WEBHOOK_URL = 'https://discord.com/api/webhooks/1448719996678045910/bZUNtO2H4G7q_iBrN1CLTuodu6kSlrW-RxCL9LqDbBO4v8wD7-XA-HjT_mLXpbYgZULH';
const REDIRECT_URI = window.location.href.split('#')[0]; 

// ==========================================
// QUIZ FRAGEN (Dienstvorschrift)
// ==========================================
const questions = [
  { 
    question: "Was ist der erste Schritt bei Streitigkeiten zwischen Kollegen (¬ß 2.2)?", 
    options: ["√ñffentlich im Funk diskutieren", "Das pers√∂nliche Gespr√§ch suchen", "Sofort die Leitungsebene rufen", "Den Dienst quittieren"], 
    correct: 1 
  },
  { 
    question: "Welche Konsequenz hat die Weitergabe von Polizeiausr√ºstung an Externe (¬ß 3.1)?", 
    options: ["Geldstrafe von 10.000$", "M√ºndliche Verwarnung", "Entlassung bis hin zur lebenslangen Haft", "Degradierung um einen Rang"], 
    correct: 2 
  },
  { 
    question: "Darf Funk 1 f√ºr Ausbildungen genutzt werden (¬ß 4.6)?", 
    options: ["Ja, wenn Funk 2 belegt ist", "Nein, Funk 1 ist der offizielle Funk", "Ja, ab 22 Uhr", "Nur f√ºr Abschlusspr√ºfungen"], 
    correct: 1 
  },
  { 
    question: "Wann darf die Schusswaffe offen getragen werden (¬ß 5.3)?", 
    options: ["Nur in aktiven Gefechten/Gro√üeins√§tzen", "Immer im Dienst zur Abschreckung", "Bei jeder Verkehrskontrolle", "Sobald man die Wache verl√§sst"], 
    correct: 0 
  },
  { 
    question: "Was muss passieren, wenn man sich in den Zivildienst begibt (¬ß 5.5)?", 
    options: ["Waffe darf zur Sicherheit behalten werden", "Ausr√ºstung im privaten Kofferraum lagern", "Alles im Pr√§sidium ablegen (Waffen & Ausr√ºstung)", "Dienstmarke behalten, Rest abgeben"], 
    correct: 2 
  },
  { 
    question: "Welche Ausr√ºstung ist auf Streife zwingend Pflicht (¬ß 5.10)?", 
    options: ["Taschenlampe", "GPS Tracker", "Fernglas", "Aktivierte Bodycam"], 
    correct: 3 
  },
  { 
    question: "Welche Fahrzeug-Modifikationen sind am Dienstwagen erlaubt (¬ß 7.2)?", 
    options: ["Unterbodenbeleuchtung & Hupe", "Fulltuning, Panzerung, Federung, Scheibent√∂nung", "Rennmotor & Turbo", "Individuelle Lackierung"], 
    correct: 1 
  },
  { 
    question: "Ist Gl√ºcksspiel (Casino) oder Barbesuch im Dienst erlaubt (¬ß 8.10)?", 
    options: ["Ja, in der Pause", "Ja, wenn kein Einsatz offen ist", "Nein, strikt verboten", "Nur Blackjack"], 
    correct: 2 
  },
  { 
    question: "Wann darf bei einer Kontrolle der Kofferraum durchsucht werden (¬ß 9.4)?", 
    options: ["Immer routinem√§√üig", "Nur bei konkretem Verdacht (z.B. BTMG, WaffG)", "Wenn der Fahrer nerv√∂s wirkt", "Bei jeder LKW-Kontrolle"], 
    correct: 1 
  },
  { 
    question: "Wie oft darf der Panic Button benutzt werden (¬ß 9.6)?", 
    options: ["Unbegrenzt", "Nur 1x am selben Ort & alle 5 Minuten", "Alle 10 Minuten", "Nur mit Erlaubnis"], 
    correct: 1 
  },
  { 
    question: "Wann darf man bei Verfolgungen auf Reifen schie√üen (¬ß 10.1)?", 
    options: ["Erst nach mehrfacher Aufforderung / im Notfall", "Sofort bei Fluchtbeginn", "Wenn das Auto zu schnell ist", "Ab 3 Minuten Verfolgung"], 
    correct: 0 
  },
  { 
    question: "Wer darf eine Razzia anordnen (¬ß 11.1)?", 
    options: ["Einsatzleitung vor Ort", "Jeder Officer", "Leitender Direktor oder h√∂her", "Der B√ºrgermeister"], 
    correct: 2 
  },
  { 
    question: "Welcher Mindestrang ist f√ºr die Einsatzleitung bei Raub√ºberf√§llen n√∂tig (¬ß 12.1)?", 
    options: ["Polizeihauptmeister [A10]", "[A10] Pol. oberkommissar/in (au√üer Genehmigung)", "Polizeiobermister", "Azubis"], 
    correct: 1 
  },
  { 
    question: "D√ºrfen Trainees alleine Streife fahren (¬ß 13.4)?", 
    options: ["Ja", "Ja, mit CopNet", "Nein, nur mit Rang h√∂her als Meister", "Nur f√ºr Verkehrskontrollen"], 
    correct: 2 
  },
  { 
    question: "Wie verh√§lt sich die SEK-Einheit ohne Spezialeinsatz (¬ß 14.7.4)?", 
    options: ["Sie fahren normal Streife (Uniform/Auto normal)", "Sie warten im Pr√§sidium", "Sie patrouillieren in Vollmontur", "Sie machen Pause"], 
    correct: 0 
  },
  { 
    question: "Was passiert bei Wiedereinstellung innerhalb von 1 Tag (¬ß 15.1)?", 
    options: ["Alter Rang bleibt", "Ein Rang runter", "Zwei R√§nge runter", "Start als Rekrut"], 
    correct: 1 
  },
  { 
    question: "Ab wie vielen Hafteinheiten ist eine Geldstrafe nicht mehr m√∂glich (¬ß 18.1)?", 
    options: ["20 (HE)INHEITEN", "30 HE (Knastpflicht)", "50 HE", "60 HE"], 
    correct: 1 
  },
  { 
    question: "Was passiert, wenn man Verkehrsschilder vor einem Blitzer entfernt (¬ß 18.4)?", 
    options: ["Nichts", "Verwarnung", "Blitzer ung√ºltig & K√ºndigung", "Geldstrafe"], 
    correct: 2 
  },
  { 
    question: "Wo d√ºrfen KEINE Blitzer aufgestellt werden (¬ß 21.2)?", 
    options: ["Auf dem Highway", "Innerhalb der Stadt", "Auf Landstra√üen", "In Tunneln"], 
    correct: 1 
  },
  { 
    question: "Ist es erlaubt, im Dienst das Oberteil auszuziehen (¬ß 8.13)?", 
    options: ["Ja, wenn es hei√ü ist", "Ja, am Strand", "Nein, weder Oberteil noch Hose", "Nur das Hemd"], 
    correct: 2 
  }
];

// ==========================================
// LOGIK: LOGIN & QUIZ
// ==========================================
let currentUser = null;
let currentQuestionIndex = 0;
let errorPoints = 0;

window.onload = () => {
  const fragment = new URLSearchParams(window.location.hash.slice(1));
  if (fragment.has('access_token')) {
    const accessToken = fragment.get('access_token');
    const tokenType = fragment.get('token_type');
    fetchDiscordUser(tokenType, accessToken);
  } else if (localStorage.getItem('police_user')) {
    const savedUser = JSON.parse(localStorage.getItem('police_user'));
    const status = localStorage.getItem('police_test_status');
    
    if (status === 'passed') {
      showDashboard(savedUser);
    } else if (status === 'failed') {
      showFailScreen();
    } else {
      startQuiz(savedUser);
    }
  }
};

document.getElementById('discordLoginBtn').addEventListener('click', () => {
  const scope = 'identify';
  const url = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${scope}`;
  window.location.href = url;
});

async function fetchDiscordUser(tokenType, accessToken) {
  try {
    const response = await fetch('https://discord.com/api/users/@me', {
      headers: { authorization: `${tokenType} ${accessToken}` }
    });
    const user = await response.json();
    
    if (localStorage.getItem(`quiz_done_${user.id}`)) {
       alert("Du hast diesen Test bereits absolviert!");
       if (localStorage.getItem('police_test_status') === 'failed') {
         showFailScreen();
       } else {
         showDashboard(user);
       }
       return;
    }
    currentUser = user;
    window.history.pushState("", document.title, window.location.pathname);
    startQuiz(user);

  } catch (error) {
    console.error(error);
    alert("Fehler beim Discord Login.");
  }
}

function startQuiz(user) {
  currentUser = user;
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('quizScreen').classList.remove('hidden');
  showQuestion();
}

function showQuestion() {
  if (currentQuestionIndex >= questions.length) {
    finishQuiz();
    return;
  }
  const q = questions[currentQuestionIndex];
  document.getElementById('qCurrent').innerText = currentQuestionIndex + 1;
  document.getElementById('qTotal').innerText = questions.length;
  document.getElementById('questionText').innerText = q.question;

  const container = document.getElementById('optionsContainer');
  container.innerHTML = '';
  q.options.forEach((opt, index) => {
    const btn = document.createElement('div');
    btn.className = 'option-btn';
    btn.innerText = opt;
    btn.onclick = () => handleAnswer(index);
    container.appendChild(btn);
  });
}

function handleAnswer(selectedIndex) {
  const correctIndex = questions[currentQuestionIndex].correct;
  if (selectedIndex !== correctIndex) errorPoints++;
  currentQuestionIndex++;
  showQuestion();
}

function finishQuiz() {
  document.getElementById('quizScreen').classList.add('hidden');
  localStorage.setItem(`quiz_done_${currentUser.id}`, 'true');
  localStorage.setItem('police_user', JSON.stringify(currentUser));
  
  const passed = errorPoints < 8; 
  sendWebhook(passed);

  if (passed) {
    localStorage.setItem('police_test_status', 'passed');
    showDashboard(currentUser);
  } else {
    localStorage.setItem('police_test_status', 'failed');
    showFailScreen();
  }
}

function sendWebhook(passed) {
  const color = passed ? 5763719 : 15548997; 
  const statusText = passed ? "BESTANDEN ‚úÖ" : "DURCHGEFALLEN ‚ùå";
  const embed = {
    title: "üëÆ‚Äç‚ôÇÔ∏è Neuer Einstellungstest Absolviert",
    color: color,
    fields: [
      { name: "Bewerber", value: `${currentUser.username} (${currentUser.id})`, inline: true },
      { name: "Fehlerpunkte", value: `${errorPoints} von ${questions.length}`, inline: true },
      { name: "Ergebnis", value: statusText }
    ],
    thumbnail: { url: `https://cdn.discordapp.com/avatars/${currentUser.id}/${currentUser.avatar}.png` },
    footer: { text: "Polizei Dienstportal" },
    timestamp: new Date().toISOString()
  };

  fetch(WEBHOOK_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ embeds: [embed] })
  });
}

// ==========================================
// LOGIK: DASHBOARD DATEN LADEN
// ==========================================
function showDashboard(user) {
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('failScreen').classList.add('hidden');
  document.getElementById('dashboardContent').style.display = 'block';
  document.getElementById('userDisplay').innerText = user.username || user.global_name;
  
  // HIER wird deine alte Funktion aufgerufen:
  loadData();
  
  // Auto-Refresh
  setInterval(loadData, 30000);
}

function showFailScreen() {
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('quizScreen').classList.add('hidden');
  document.getElementById('failScreen').classList.remove('hidden');
}

function logout() {
  localStorage.clear();
  window.location.href = window.location.pathname;
}

// Deine urspr√ºngliche loadData Funktion (angepasst f√ºr das neue Layout)
async function loadData() {
  try {
    const response = await fetch("https://raw.githubusercontent.com/TubaTankBoy/Polizeidrp-Website/main/assets/police-data.json");
    if (!response.ok) throw new Error('Datei nicht gefunden');
    const data = await response.json();
    
    // Stats
    document.getElementById('statTotal').textContent = data.statistiken.gesamtMitarbeiter;
    document.getElementById('statOnDuty').textContent = data.statistiken.aktuellImDienst;
    document.getElementById('statFree').textContent = data.statistiken.freieDienstnummern;
    
    // On Duty List
    const dutyList = document.getElementById('dutyList');
    if (data.onDuty.length === 0) {
      dutyList.innerHTML = '<div class="empty-state">Aktuell ist niemand im Dienst</div>';
    } else {
      dutyList.innerHTML = data.onDuty.map(person => `
        <div class="duty-card">
          <div class="duty-header">
            <img src="${person.avatar}" class="duty-avatar" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2248%22 height=%2248%22><rect fill=%22%23ffd700%22 width=%2248%22 height=%2248%22/><text x=%2224%22 y=%2232%22 font-size=%2220%22 text-anchor=%22middle%22 fill=%22%230a0e27%22>üë§</text></svg>'">
            <div>
              <h4>${person.displayName}</h4>
              <div class="duty-badge">[${person.dienstnummer}]</div>
            </div>
          </div>
          <div class="duty-details">
            <div><span>Rang:</span> <span class="duty-val">${person.rang}</span></div>
            <div><span>Seit:</span> <span class="duty-val">${person.seit}</span></div>
            <div><span>Dauer:</span> <span class="duty-val">${person.dauer}</span></div>
          </div>
        </div>
      `).join('');
    }

    // Freie Nummern
    const nummernList = document.getElementById('nummernList');
    if (data.freeDienstnummern.length === 0) {
       nummernList.innerHTML = '<div class="empty-state">Alle vergeben</div>';
    } else {
       nummernList.innerHTML = data.freeDienstnummern.map(num => 
         `<div class="nummer-badge">${num}</div>`
       ).join('');
    }

    // Nachrichten
    const messageList = document.getElementById('messageList');
    if (data.polizeiInformationen.length === 0) {
       messageList.innerHTML = '<div class="empty-state">Keine Nachrichten</div>';
    } else {
       messageList.innerHTML = data.polizeiInformationen.map(msg => `
         <div class="message-card">
           <div class="message-meta">
             <span class="message-author">${msg.autor}</span> ‚Ä¢ ${msg.datum} um ${msg.uhrzeit}
           </div>
           <div>${msg.nachricht}</div>
         </div>
       `).join('');
    }

  } catch (error) {
    console.error('Ladefehler:', error);
  }
}
</script>
</body>
</html>
