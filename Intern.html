<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<link rel="icon" href="./assets/favicon.png">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Interner Bereich - Polizei - Deutschland RP</title>
<style>
/* ================= DEIN BESTEHENDER STYLE (GEKÃœRZT FÃœR ÃœBERSICHT) ================= */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1419 100%); color: #fff; min-height: 100vh; }
body.login-mode { display: flex; align-items: center; justify-content: center; padding: 20px; }
.container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

/* ================= LOGIN & HEADER STYLES (WIE GEHABT) ================= */
.login-container { background: linear-gradient(135deg, rgba(15, 32, 39, 0.95), rgba(44, 83, 100, 0.9)); backdrop-filter: blur(10px); border-radius: 20px; padding: 50px 40px; max-width: 450px; width: 100%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 215, 0, 0.3); text-align: center; }
.login-logo { width: 80px; height: 80px; background: rgba(255, 215, 0, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 30px; font-size: 40px; border: 2px solid #ffd700; }
.login-title { font-size: 32px; font-weight: 900; background: linear-gradient(135deg, #ffd700, #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 15px; }
.login-subtitle { color: #cbd5e0; margin-bottom: 40px; font-size: 16px; }
.form-input { width: 100%; padding: 15px 20px; border-radius: 12px; border: 2px solid rgba(255, 215, 0, 0.3); background: rgba(255, 255, 255, 0.1); color: #fff; font-size: 16px; }
.btn-login { width: 100%; padding: 15px 20px; background: linear-gradient(135deg, #ffd700, #ffed4e); color: #0f2027; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; text-transform: uppercase; }
.protected-content { display: none; }
.protected-content.show { display: block; }
.header { background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)); border-bottom: 3px solid #ffd700; padding: 60px 0 40px; text-align: center; position: relative; }
.discord-widget-container { position: absolute; top: 20px; right: 20px; z-index: 2000; }
.discord-btn { background-color: #5865F2; color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; display: flex; align-items: center; gap: 10px; cursor: pointer; border:none; }
.discord-profile { display: none; align-items: center; gap: 10px; background: rgba(40, 43, 48, 0.9); border: 1px solid #5865F2; padding: 5px 15px 5px 5px; border-radius: 50px; }
.discord-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #5865F2; }

/* ================= DIENSTVORSCHRIFT SPEZIAL DESIGN (GOOGLE DOCS STYLE) ================= */
.pdv-section { margin-top: 50px; }
.pdv-toolbar {
    background: #2a2f45;
    padding: 10px 20px;
    border-radius: 12px 12px 0 0;
    display: none; /* Nur fÃ¼r Admins */
    justify-content: space-between;
    align-items: center;
    border: 1px solid rgba(255, 215, 0, 0.3);
}

.pdv-paper {
    background: #ffffff;
    color: #1a1f3a;
    padding: 60px 80px;
    border-radius: 0 0 12px 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    min-height: 800px;
    font-family: 'Times New Roman', Times, serif; /* Dokumenten-Stil */
    line-height: 1.6;
}

.pdv-paper h1 { text-align: center; color: #003366; border-bottom: 2px solid #003366; margin-bottom: 30px; font-family: sans-serif; }
.pdv-paper h2 { color: #003366; margin-top: 25px; border-bottom: 1px solid #ccc; font-family: sans-serif; }
.pdv-paper p { margin-bottom: 15px; font-size: 16px; }
.section-id { font-weight: bold; color: #d32f2f; margin-right: 5px; }

.save-btn {
    background: #4ade80;
    color: #0a0e27;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    font-weight: 800;
    cursor: pointer;
}

/* Restliche Stats/Listen Styles (wie in deiner Vorlage) */
.section { background: linear-gradient(135deg, rgba(26, 31, 58, 0.9), rgba(15, 20, 25, 0.8)); border-radius: 16px; padding: 40px; margin: 30px 0; border: 1px solid rgba(255, 215, 0, 0.2); }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin: 40px 0; }
.stat-card { background: rgba(26, 31, 58, 0.9); border-radius: 16px; padding: 30px; border: 1px solid rgba(255, 215, 0, 0.2); text-align: center; }
.stat-value { font-size: 36px; font-weight: 900; color: #ffd700; }
</style>
</head>
<body class="login-mode">

<div class="login-container" id="loginScreen">
  <div class="login-logo">ðŸ”’</div>
  <h1 class="login-title">Interner Bereich</h1>
  <p class="login-subtitle">Passwort erforderlich (99199)</p>
  <form onsubmit="return checkPassword(event)">
    <input type="password" id="password" class="form-input" placeholder="Passwort...">
    <button type="submit" class="btn-login" style="margin-top:20px">Zugang erhalten</button>
    <div class="error-message" id="errorMessage" style="color:red; display:none; margin-top:10px">Falsches Passwort!</div>
  </form>
</div>

<div class="protected-content" id="protectedContent">
  <header class="header">
    <div class="discord-widget-container">
        <button id="discordLoginBtn" class="discord-btn" onclick="loginWithDiscord()">Discord Login</button>
        <div id="discordProfile" class="discord-profile">
            <img id="discordAvatar" src="" class="discord-avatar">
            <span id="discordUsername" class="discord-username"></span>
            <div onclick="logoutDiscord()" style="cursor:pointer; margin-left:10px">âœ•</div>
        </div>
    </div>
    <div class="container">
      <h1 style="font-size:56px; font-weight:900;">POLIZEI</h1>
      <div style="color:#ffd700; font-size:24px;">DEUTSCHLAND RP - INTERNER BEREICH</div>
    </div>
  </header>

  <main class="container">
    <div class="stats-grid">
      <div class="stat-card"><div>ðŸ‘¥ Gesamt</div><div class="stat-value" id="statTotal">-</div></div>
      <div class="stat-card"><div>ðŸŸ¢ Im Dienst</div><div class="stat-value" id="statOnDuty">-</div></div>
      <div class="stat-card"><div>ðŸ“‹ Freie Nummern</div><div class="stat-value" id="statFree">-</div></div>
    </div>

    <section class="pdv-section">
        <div id="adminToolbar" class="pdv-toolbar">
            <span>âœ¨ <b>Admin-Modus:</b> Du kannst das Dokument jetzt bearbeiten</span>
            <button class="save-btn" onclick="savePDV()">ðŸ’¾ Dokument speichern</button>
        </div>
        <div class="pdv-paper" id="pdvDocument">
            <h1>POLIZEIDIENSTVORSCHRIFT</h1>
            <p style="text-align:center;"><b>PRÃ„SIDIUM DEUTSCHLAND RP</b></p>
            <hr><br>

            <h2>VORWORT</h2>
            <p>Die Dienstvorschrift der Polizei gilt fÃ¼r jeden Beamten. Mit dem Beitritt in die Polizei erklÃ¤rt ihr euch bereit, die Dienstvorschrift gelesen und verstanden zu haben. Bei Nichteinhaltung werden Disziplinarstrafen bis hin zur KÃ¼ndigung ausgesprochen.</p>

            <h2>Â§ 1 - VORBILDFUNKTION</h2>
            <p><span class="section-id">1.1</span> Als Mitarbeiter der Polizei hat man eine Vorbildfunktion. Man hat sich stets professionell zu verhalten.</p>
            <p><span class="section-id">1.2</span> Ist ein Beamter zivil unterwegs, hat er sein Verhalten gegenÃ¼ber der Polizei anzupassen.</p>
            <p><span class="section-id">1.3</span> Jeder Beamte hat sich entsprechend der erlernten Ausbildung zu verhalten.</p>
            <p><span class="section-id">1.5</span> Die Polizei ist gegen "Gambo". Wer meint dies trotzdem zu machen, wird sanktioniert.</p>
            <p><span class="section-id">1.6</span> Ein ordentliches Erscheinungsbild ist Pflicht. Provokante Auftreten (z.B. Talahon-Style) sind unerwÃ¼nscht.</p>

            <h2>Â§ 2 - KAMERADSCHAFT</h2>
            <p><span class="section-id">2.1</span> Innerhalb der Polizei hat Kameradschaft einen sehr hohen Stellenwert.</p>
            <p><span class="section-id">2.2</span> Streitigkeiten sollten zuerst im persÃ¶nlichen GesprÃ¤ch geklÃ¤rt werden.</p>

            <h2>Â§ 3 - SCHWEIGEPFLICHT</h2>
            <p><span class="section-id">3.1</span> Es ist strengstens verboten, PolizeiausrÃ¼stung oder Informationen an Externe weiterzugeben. Dies gilt als Korruption.</p>

            </div>
    </section>

    <button class="btn-logout" onclick="logout()" style="margin-top:50px; background:rgba(255,0,0,0.2); padding:10px 20px; border-radius:8px; border:1px solid red; color:white; cursor:pointer;">ðŸšª Abmelden</button>
  </main>
</div>

<script>
const PASSWORD = '99199';
const ALLOWED_DISCORD_IDS = ["434833602916909067", "1004487638297886731", "689614950691635338"];
const DISCORD_CLIENT_ID = "1448720203113300161"; 
const REDIRECT_URI = window.location.href.split('#')[0].split('?')[0];

function loginWithDiscord() {
    const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify`;
    window.location.href = authUrl;
}

function checkDiscordLogin() {
    const storedUser = localStorage.getItem('discord_user');
    if (storedUser) {
        const user = JSON.parse(storedUser);
        showDiscordProfile(user);
        enableEditingIfAllowed(user.id);
        return;
    }

    const fragment = new URLSearchParams(window.location.hash.slice(1));
    const accessToken = fragment.get('access_token');

    if (accessToken) {
        fetch('https://discord.com/api/users/@me', {
            headers: { authorization: `Bearer ${accessToken}` },
        })
        .then(res => res.json())
        .then(response => {
            if (response.id) {
                const userData = {
                    id: response.id,
                    username: response.username,
                    avatar: `https://cdn.discordapp.com/avatars/${response.id}/${response.avatar}.png`
                };
                localStorage.setItem('discord_user', JSON.stringify(userData));
                showDiscordProfile(userData);
                enableEditingIfAllowed(userData.id);
                history.pushState("", document.title, window.location.pathname);
            }
        });
    }
}

function enableEditingIfAllowed(userId) {
    if (ALLOWED_DISCORD_IDS.includes(userId)) {
        document.getElementById('pdvDocument').contentEditable = "true";
        document.getElementById('adminToolbar').style.display = "flex";
    }
}

function savePDV() {
    const content = document.getElementById('pdvDocument').innerHTML;
    // In einer echten Umgebung wÃ¼rde man das per API an eine DB senden.
    // Hier speichern wir es lokal fÃ¼r den Browser:
    localStorage.setItem('saved_pdv_content', content);
    alert("âœ… Dienstvorschrift wurde erfolgreich gespeichert!");
}

function showDiscordProfile(user) {
    document.getElementById('discordLoginBtn').style.display = 'none';
    document.getElementById('discordProfile').style.display = 'flex';
    document.getElementById('discordUsername').textContent = user.username;
    document.getElementById('discordAvatar').src = user.avatar;
}

function checkPassword(event) {
  event.preventDefault();
  if (document.getElementById('password').value === PASSWORD) {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('protectedContent').classList.add('show');
    document.body.classList.remove('login-mode');
    sessionStorage.setItem('loggedIn', 'true');
    checkDiscordLogin();
    
    // Geladene PDV wiederherstellen falls vorhanden
    const saved = localStorage.getItem('saved_pdv_content');
    if(saved) document.getElementById('pdvDocument').innerHTML = saved;
  } else {
    document.getElementById('errorMessage').style.display = 'block';
  }
}

function logout() { sessionStorage.removeItem('loggedIn'); location.reload(); }
function logoutDiscord() { localStorage.removeItem('discord_user'); location.reload(); }

window.addEventListener('DOMContentLoaded', () => {
  if (sessionStorage.getItem('loggedIn') === 'true') {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('protectedContent').classList.add('show');
    document.body.classList.remove('login-mode');
    checkDiscordLogin();
    const saved = localStorage.getItem('saved_pdv_content');
    if(saved) document.getElementById('pdvDocument').innerHTML = saved;
  }
});
</script>
</body>
</html>
